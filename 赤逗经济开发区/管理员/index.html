<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ¤é€—ç»æµå¼€å‘åŒº Â· ç®¡ç†å‘˜ç»ˆç«¯</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            background: #1e3a47;
            font-family: 'Segoe UI', Roboto, monospace;
            padding: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .admin-panel {
            max-width: 1400px;
            width: 100%;
            background: #ecf0f3;
            border-radius: 36px;
            padding: 2rem;
            box-shadow: 0 20px 30px rgba(0,0,0,0.5);
            border: 1px solid #a5c9ca;
        }
        .login-area {
            background: white;
            border-radius: 24px;
            padding: 2.5rem;
            text-align: center;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.03);
        }
        .login-title {
            font-size: 2rem;
            color: #0b4e5c;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        .password-hint {
            background: #fef0d9;
            padding: 1rem;
            border-radius: 50px;
            color: #7d5a2a;
            margin: 1.5rem 0;
            font-size: 1.2rem;
            border: 2px dashed #b38f4a;
        }
        .password-input {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        .pwd-field {
            background: #f0f7fa;
            border: 3px solid #bfd8e0;
            border-radius: 60px;
            padding: 1rem 1.8rem;
            font-size: 1.3rem;
            width: 300px;
            text-align: center;
            letter-spacing: 6px;
            font-family: monospace;
        }
        .pwd-field:focus {
            border-color: #0e7e8c;
            outline: none;
            box-shadow: 0 0 0 4px rgba(15,126,140,0.3);
        }
        .btn {
            background: #1f8a9c;
            border: none;
            border-bottom: 5px solid #0e525e;
            color: white;
            font-weight: bold;
            padding: 1rem 2.5rem;
            border-radius: 60px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.1s;
        }
        .btn:active {
            border-bottom-width: 2px;
            transform: translateY(3px);
        }
        .btn-danger {
            background: #6f8f8c;
            border-bottom-color: #3e5552;
            cursor: not-allowed;
            opacity: 0.7;
        }
        .records-area {
            margin-top: 2rem;
            background: white;
            border-radius: 28px;
            padding: 2rem;
            box-shadow: 0 8px 0 #b0c9d0;
        }
        .area-title {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 1.5rem;
            color: #0b4e5c;
            border-bottom: 3px solid #7ab3c0;
            padding-bottom: 0.6rem;
        }
        .table-responsive {
            overflow-x: auto;
            border-radius: 18px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: #fdfefe;
            border-radius: 16px;
        }
        th {
            background: #1e6a75;
            color: white;
            padding: 0.9rem 0.5rem;
            font-weight: 600;
            white-space: nowrap;
        }
        td {
            padding: 0.8rem 0.5rem;
            border-bottom: 1px solid #cde3e7;
            text-align: center;
            word-break: break-word;
        }
        tr:last-child td { border-bottom: none; }
        .mac-badge {
            background: #2e6270;
            color: white;
            padding: 0.2rem 0.7rem;
            border-radius: 30px;
            font-family: monospace;
            font-size: 0.8rem;
            display: inline-block;
        }
        .null-msg {
            padding: 3rem;
            text-align: center;
            color: #5b7e84;
            font-size: 1.2rem;
        }
        .footer-note {
            margin-top: 1.5rem;
            color: #3f5c63;
            font-size: 0.85rem;
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="admin-panel">
        <!-- ç™»å½•åŒºåŸŸï¼Œåˆå§‹æ˜¾ç¤º -->
        <div id="loginBlock" class="login-area">
            <div class="login-title">ğŸ” ç®¡ç†å‘˜ä¸“ç”¨</div>
            <div class="password-hint">
                âš ï¸ è¯·è¾“å…¥6ä¸ªç©ºæ ¼ä½œä¸ºå¯†ç <br>
                <span style="font-size:1.5rem; letter-spacing:8px;">â£â£â£â£â£â£</span>
            </div>
            <div class="password-input">
                <input type="password" id="adminPwd" class="pwd-field" placeholder="å…­ä¸ªç©ºæ ¼" maxlength="6" autocomplete="off">
                <button id="loginBtn" class="btn">è¿›å…¥ç»ˆç«¯</button>
            </div>
            <div id="loginError" style="color: #b33; margin-top: 1rem; min-height: 2rem;"></div>
        </div>

        <!-- è®°å½•å±•ç¤ºåŒºåŸŸï¼ˆåˆå§‹éšè—ï¼‰ -->
        <div id="recordsBlock" style="display: none;">
            <div class="records-area">
                <div class="area-title">
                    <h2 style="font-size: 1.8rem;">ğŸ“‹ å…¨éƒ¨å…¥ç½‘è®°å½•ï¼ˆåªè¯»ï¼‰</h2>
                    <span style="background: #1d6b6f; color: white; padding: 0.4rem 1.2rem; border-radius: 50px;">
                        ğŸ—‚ï¸ å…± <span id="recordCount">0</span> æ¡è®°å½•
                    </span>
                </div>
                <div class="table-responsive" id="recordTableContainer">
                    <!-- è¡¨æ ¼ç”±JSåŠ¨æ€æ¸²æŸ“ -->
                </div>
                <div class="footer-note">
                    * æ‰€æœ‰æ•°æ®æ¥æºäºæœ¬åœ°å­˜å‚¨ï¼ˆæ¨¡æ‹Ÿç›¸å¯¹ç›®å½•æ–‡ä»¶ï¼‰ï¼Œç®¡ç†å‘˜ä»…å¯æŸ¥çœ‹ï¼Œä¸å¯åˆ é™¤æˆ–ä¿®æ”¹ã€‚
                </div>
                <div style="margin-top: 1.5rem; display: flex; gap: 1rem; justify-content: flex-end;">
                    <button id="logoutBtn" class="btn" style="background: #476b6f;">â¬…ï¸ é€€å‡ºç™»å½•</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            const STORAGE_KEY = 'chidou_network_records';
            // å¯†ç ï¼š6ä¸ªç©ºæ ¼
            const ADMIN_PASSWORD = '      ';  // å…­ä¸ªç©ºæ ¼

            const loginBlock = document.getElementById('loginBlock');
            const recordsBlock = document.getElementById('recordsBlock');
            const adminPwd = document.getElementById('adminPwd');
            const loginBtn = document.getElementById('loginBtn');
            const loginError = document.getElementById('loginError');
            const logoutBtn = document.getElementById('logoutBtn');
            const recordCountSpan = document.getElementById('recordCount');
            const tableContainer = document.getElementById('recordTableContainer');

            // è·å–è®°å½•
            function getRecords() {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? JSON.parse(data) : [];
            }

            // æ¸²æŸ“è¡¨æ ¼ï¼ˆçº¯å±•ç¤ºï¼Œæ²¡æœ‰ä»»ä½•åˆ é™¤/ç¼–è¾‘æ§ä»¶ï¼‰
            function renderRecords() {
                const records = getRecords();
                recordCountSpan.innerText = records.length;

                if (records.length === 0) {
                    tableContainer.innerHTML = `<div class="null-msg">ğŸ“­ æš‚æ— ä»»ä½•è¿æ¥è®°å½•</div>`;
                    return;
                }

                // æŒ‰æ—¶é—´å€’åºï¼ˆæœ€è¿‘çš„åœ¨æœ€ä¸Šé¢ï¼‰
                const sorted = [...records].sort((a,b) => (a.time < b.time ? 1 : -1));

                let html = `<table>
                    <thead>
                        <tr>
                            <th>æ‰‹æœºå·</th>
                            <th>æ‰€å±å…³ç³»</th>
                            <th>åŸå› </th>
                            <th>åˆ†é… IP</th>
                            <th>MAC åœ°å€</th>
                            <th>è¿æ¥æ—¶é—´</th>
                        </tr>
                    </thead>
                    <tbody>`;

                sorted.forEach(rec => {
                    html += `<tr>
                        <td>${escapeHtml(rec.phone || '')}</td>
                        <td>${escapeHtml(rec.affiliation || '')}</td>
                        <td>${escapeHtml(rec.reason || '')}</td>
                        <td style="font-weight:600; color:#0e5e6b;">${escapeHtml(rec.ip || '')}</td>
                        <td><span class="mac-badge">${escapeHtml(rec.mac || '')}</span></td>
                        <td>${escapeHtml(rec.time || '')}</td>
                    </tr>`;
                });

                html += `</tbody></table>`;
                tableContainer.innerHTML = html;
            }

            // ç®€å•çš„é˜²XSS
            function escapeHtml(unsafe) {
                if (!unsafe) return '';
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }

            // ç™»å½•éªŒè¯
            function handleLogin() {
                const pwd = adminPwd.value;
                if (pwd === ADMIN_PASSWORD) {
                    loginBlock.style.display = 'none';
                    recordsBlock.style.display = 'block';
                    renderRecords();
                    loginError.innerText = '';
                } else {
                    loginError.innerText = 'âŒ å¯†ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼ˆ6ä¸ªç©ºæ ¼ï¼‰';
                    adminPwd.value = '';
                    adminPwd.focus();
                }
            }

            loginBtn.addEventListener('click', handleLogin);
            adminPwd.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleLogin();
                }
            });

            // é€€å‡ºç™»å½•
            logoutBtn.addEventListener('click', () => {
                recordsBlock.style.display = 'none';
                loginBlock.style.display = 'block';
                adminPwd.value = '';
                loginError.innerText = '';
            });

            // å¦‚æœç›´æ¥è®¿é—®è®°å½•åŒºå—ï¼ˆæ¯”å¦‚ä¹‹å‰ç™»å½•è¿‡ï¼‰ï¼Œä½†åˆ·æ–°åæ¢å¤ç™»å½•ç•Œé¢ã€‚æ— éœ€é¢å¤–æ“ä½œã€‚
            // ç¡®ä¿åˆå§‹çŠ¶æ€æ­£ç¡®
        })();
    </script>
</body>
</html>