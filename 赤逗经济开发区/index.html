<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>èµ¤é€—ç»æµå¼€å‘åŒº Â· å®˜æ–¹å…¥ç½‘</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(145deg, #1a4b58 0%, #0d3b45 100%);
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }

        .container {
            max-width: 900px;
            width: 100%;
        }

        .main-card {
            background: white;
            border-radius: 48px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        /* æ­¥éª¤æŒ‡ç¤ºå™¨ */
        .steps-header {
            display: flex;
            background: #f8fbfc;
            padding: 1.5rem 2rem;
            border-bottom: 3px solid #ffc107;
        }
        .step {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0edf2;
            color: #1d5a64;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }
        .step.active .step-number {
            background: #ffc107;
            color: #0b3b44;
            box-shadow: 0 4px 0 #b8820b;
        }
        .step-title {
            font-weight: 600;
            color: #1d5a64;
        }
        .step.active .step-title {
            color: #0b3b44;
            font-weight: 700;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content-area {
            padding: 2.5rem;
        }

        /* ç¬¬ä¸€æ­¥ï¼šå¡«å†™ä¿¡æ¯ */
        .step-one {
            display: block;
        }
        .step-two {
            display: none;
        }
        .step-three {
            display: none;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #0b4e5c;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .section-title span {
            background: #ffc107;
            color: #0b4e5c;
            padding: 0.2rem 1rem;
            border-radius: 40px;
            font-size: 0.9rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .input-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .input-item label {
            font-weight: 600;
            color: #1d5a64;
            font-size: 1rem;
        }
        .required-star {
            color: #c0392b;
            margin-left: 4px;
        }
        .input-field {
            background: #f5fbfd;
            border: 2px solid #bfdbe0;
            border-radius: 30px;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            transition: 0.2s;
        }
        .input-field:focus {
            border-color: #0f7e8c;
            background: white;
            outline: none;
            box-shadow: 0 0 0 4px rgba(15,126,140,0.15);
        }

        .btn {
            border: none;
            font-weight: 700;
            padding: 1rem 2.5rem;
            border-radius: 60px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.05s linear;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
        }
        .btn-primary {
            background: #1f8a9c;
            color: white;
            border-bottom: 6px solid #0e525e;
        }
        .btn-primary:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }
        .btn-warning {
            background: #ffc107;
            color: #0b3b44;
            border-bottom: 6px solid #b8820b;
        }
        .btn-warning:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }
        .btn-success {
            background: #28a745;
            color: white;
            border-bottom: 6px solid #1e7e34;
        }
        .btn-success:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        .wifi-info-card {
            background: linear-gradient(135deg, #0f5a66 0%, #0b4752 100%);
            border-radius: 32px;
            padding: 2rem;
            color: white;
            margin: 2rem 0;
            box-shadow: 0 10px 0 #06333b;
        }
        .wifi-name {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .wifi-password-box {
            background: rgba(0,0,0,0.3);
            border-radius: 24px;
            padding: 1.5rem;
            text-align: center;
            margin: 1.5rem 0;
        }
        .wifi-password {
            font-size: 3rem;
            font-weight: 800;
            font-family: monospace;
            letter-spacing: 8px;
            background: #1e3a42;
            padding: 0.5rem 2rem;
            border-radius: 60px;
            border: 2px dashed #ffc107;
            color: #ffe484;
        }

        .status-box {
            background: #f8f9fa;
            border-left: 10px solid #6c757d;
            border-radius: 20px;
            padding: 1.5rem;
            margin: 2rem 0;
            font-size: 1.1rem;
        }
        .status-success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .reminder-box {
            background: #fff3cd;
            border-left: 10px solid #ffc107;
            border-radius: 20px;
            padding: 1.2rem;
            margin: 1.5rem 0;
        }
        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-card">
            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="steps-header">
                <div class="step active" id="step1Indicator">
                    <div class="step-number">1</div>
                    <div class="step-title">å¡«å†™ä¿¡æ¯</div>
                </div>
                <div class="step" id="step2Indicator">
                    <div class="step-number">2</div>
                    <div class="step-title">è¿æ¥WiFi</div>
                </div>
                <div class="step" id="step3Indicator">
                    <div class="step-number">3</div>
                    <div class="step-title">ä¸Šä¼ å‡­è¯</div>
                </div>
            </div>

            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="content-area">
                <!-- ç¬¬ä¸€æ­¥ï¼šå¡«å†™ä¿¡æ¯ -->
                <div id="stepOne" class="step-one">
                    <div class="section-title">
                        ğŸ“‹ å¡«å†™å…¥ç½‘ä¿¡æ¯
                        <span>å¿…å¡«</span>
                    </div>
                    
                    <div class="form-grid">
                        <div class="input-item">
                            <label>ğŸ“± æ‰‹æœºå·ç  <span class="required-star">*</span></label>
                            <input type="tel" id="phone" class="input-field" placeholder="11ä½æ‰‹æœºå·" maxlength="11">
                        </div>
                        <div class="input-item">
                            <label>ğŸ‘¤ å§“å <span class="required-star">*</span></label>
                            <input type="text" id="name" class="input-field" placeholder="çœŸå®å§“å">
                        </div>
                        <div class="input-item">
                            <label>ğŸ¢ æ‰€å±å•ä½</label>
                            <input type="text" id="affiliation" class="input-field" placeholder="é€‰å¡«">
                        </div>
                    </div>

                    <div class="reminder-box">
                        <strong>ğŸ“Œ å¡«å†™å®Œæˆåï¼š</strong> ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–WiFiä¿¡æ¯ï¼Œç„¶åæ‰‹åŠ¨è¿æ¥ç½‘ç»œ
                    </div>

                    <div class="button-group">
                        <button id="toStep2Btn" class="btn btn-primary">ä¸‹ä¸€æ­¥ï¼šè·å–WiFiä¿¡æ¯ â†’</button>
                    </div>
                </div>

                <!-- ç¬¬äºŒæ­¥ï¼šæ˜¾ç¤ºWiFiä¿¡æ¯ -->
                <div id="stepTwo" class="step-two">
                    <div class="section-title">
                        ğŸ“¶ è¿æ¥WiFiç½‘ç»œ
                    </div>

                    <div class="wifi-info-card">
                        <div class="wifi-name">
                            ğŸ“¡ èµ¤é€—ç»æµå¼€å‘åŒº
                            <span style="background:#ffc107; color:#0b3b44; padding:0.2rem 1rem; border-radius:40px; font-size:0.9rem;">å®˜æ–¹ä¸“ç½‘</span>
                        </div>
                        
                        <div class="wifi-password-box">
                            <div style="margin-bottom:1rem; opacity:0.9;">WiFi å¯†ç </div>
                            <div class="wifi-password" id="wifiPassword">20268888</div>
                        </div>

                        <div style="background:white; color:#0b4e5c; border-radius:20px; padding:1.5rem;">
                            <strong>ğŸ“± è¿æ¥æ­¥éª¤ï¼š</strong>
                            <ol style="margin-top:0.8rem; margin-left:1.5rem;">
                                <li>æ‰“å¼€æ‰‹æœºã€Œè®¾ç½®ã€>ã€ŒWLAN/WiFiã€</li>
                                <li>æ‰¾åˆ°ç½‘ç»œ <strong>â€œèµ¤é€—ç»æµå¼€å‘åŒºâ€</strong></li>
                                <li>è¾“å…¥å¯†ç  <strong>20268888</strong></li>
                                <li>ç‚¹å‡»ã€Œè¿æ¥ã€</li>
                            </ol>
                        </div>
                    </div>

                    <div class="reminder-box">
                        <strong>âš ï¸ é‡è¦æé†’ï¼š</strong> è¿æ¥WiFiæˆåŠŸåï¼Œè¯·åŠ¡å¿…è¿”å›æœ¬é¡µï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å®Œæˆæœ€åä¸€æ­¥ï¼
                    </div>

                    <div class="button-group">
                        <button id="backToStep1Btn" class="btn" style="background:#e0edf2; color:#1d5a64;">â† ä¸Šä¸€æ­¥</button>
                        <button id="toStep3Btn" class="btn btn-warning">âœ… æˆ‘å·²è¿æ¥æˆåŠŸï¼Œä¸‹ä¸€æ­¥</button>
                    </div>
                </div>

                <!-- ç¬¬ä¸‰æ­¥ï¼šä¸Šä¼ MACå’ŒIP -->
                <div id="stepThree" class="step-three">
                    <div class="section-title">
                        ğŸ”„ è‡ªåŠ¨ä¸Šä¼ å‡­è¯
                    </div>

                    <div id="deviceInfo" class="status-box">
                        ğŸ” æ­£åœ¨æ£€æµ‹è®¾å¤‡ä¿¡æ¯...
                    </div>

                    <div id="uploadStatus" class="status-box" style="display: none;">
                        <!-- åŠ¨æ€æ˜¾ç¤ºä¸Šä¼ çŠ¶æ€ -->
                    </div>

                    <div class="button-group">
                        <button id="backToStep2Btn" class="btn" style="background:#e0edf2; color:#1d5a64;">â† è¿”å›</button>
                        <button id="uploadBtn" class="btn btn-success">ğŸ“¤ è‡ªåŠ¨ä¸Šä¼ MACå’ŒIP</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // WiFiä¿¡æ¯
            const WIFI_NAME = 'èµ¤é€—ç»æµå¼€å‘åŒº';
            const WIFI_PASSWORD = '20268888';
            
            // å­˜å‚¨ç”¨æˆ·å¡«å†™çš„ä¿¡æ¯
            let userPhone = '';
            let userName = '';
            let userAffiliation = '';

            // DOM å…ƒç´ 
            const step1Indicator = document.getElementById('step1Indicator');
            const step2Indicator = document.getElementById('step2Indicator');
            const step3Indicator = document.getElementById('step3Indicator');
            
            const stepOne = document.getElementById('stepOne');
            const stepTwo = document.getElementById('stepTwo');
            const stepThree = document.getElementById('stepThree');
            
            const phoneInput = document.getElementById('phone');
            const nameInput = document.getElementById('name');
            const affInput = document.getElementById('affiliation');
            
            const toStep2Btn = document.getElementById('toStep2Btn');
            const backToStep1Btn = document.getElementById('backToStep1Btn');
            const toStep3Btn = document.getElementById('toStep3Btn');
            const backToStep2Btn = document.getElementById('backToStep2Btn');
            const uploadBtn = document.getElementById('uploadBtn');
            
            const deviceInfo = document.getElementById('deviceInfo');
            const uploadStatus = document.getElementById('uploadStatus');

            // æ­¥éª¤åˆ‡æ¢å‡½æ•°
            function showStep(step) {
                // éšè—æ‰€æœ‰æ­¥éª¤
                stepOne.style.display = 'none';
                stepTwo.style.display = 'none';
                stepThree.style.display = 'none';
                
                // é‡ç½®æ‰€æœ‰æŒ‡ç¤ºå™¨
                step1Indicator.classList.remove('active');
                step2Indicator.classList.remove('active');
                step3Indicator.classList.remove('active');
                
                if (step === 1) {
                    stepOne.style.display = 'block';
                    step1Indicator.classList.add('active');
                } else if (step === 2) {
                    stepTwo.style.display = 'block';
                    step2Indicator.classList.add('active');
                } else if (step === 3) {
                    stepThree.style.display = 'block';
                    step3Indicator.classList.add('active');
                    // è¿›å…¥ç¬¬ä¸‰æ­¥æ—¶æ£€æµ‹è®¾å¤‡ä¿¡æ¯
                    detectDeviceInfo();
                }
            }

            // æ£€æµ‹è®¾å¤‡ä¿¡æ¯ï¼ˆMACå’ŒIPï¼‰
            function detectDeviceInfo() {
                deviceInfo.innerHTML = 'ğŸ” æ­£åœ¨æ£€æµ‹è®¾å¤‡ä¿¡æ¯...';
                
                // æ¨¡æ‹Ÿæ£€æµ‹è¿‡ç¨‹ï¼ˆå®é™…æµè§ˆå™¨æ— æ³•è·å–çœŸå®MACï¼Œè¿™é‡Œç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ï¼‰
                setTimeout(() => {
                    // ç”ŸæˆéšæœºMACåœ°å€
                    const mac = generateMAC();
                    
                    // è·å–æœ¬åœ°IPï¼ˆæ¨¡æ‹Ÿï¼‰
                    const ip = getLocalIP();
                    
                    // è·å–è®¾å¤‡ç±»å‹
                    const deviceType = detectDeviceType();
                    
                    deviceInfo.innerHTML = `
                        <div style="display: grid; grid-template-columns: auto 1fr; gap: 1rem; align-items: center;">
                            <div style="font-weight:600;">ğŸ–¥ï¸ è®¾å¤‡ç±»å‹ï¼š</div>
                            <div>${deviceType}</div>
                            <div style="font-weight:600;">ğŸŒ IPåœ°å€ï¼š</div>
                            <div><code>${ip}</code></div>
                            <div style="font-weight:600;">ğŸ”¢ MACåœ°å€ï¼š</div>
                            <div><code>${mac}</code></div>
                            <div style="font-weight:600;">ğŸ“¶ è¿æ¥ç½‘ç»œï¼š</div>
                            <div>${WIFI_NAME}</div>
                        </div>
                    `;
                    
                    // ä¿å­˜åˆ°å…¨å±€å˜é‡ï¼Œä¾›ä¸Šä¼ ä½¿ç”¨
                    window.deviceMAC = mac;
                    window.deviceIP = ip;
                    window.deviceType = deviceType;
                }, 800);
            }

            // ç”ŸæˆéšæœºMACåœ°å€
            function generateMAC() {
                const hex = '0123456789ABCDEF';
                let mac = '';
                for (let i = 0; i < 6; i++) {
                    let byte = '';
                    for (let j = 0; j < 2; j++) byte += hex[Math.floor(Math.random() * 16)];
                    mac += (i ? ':' : '') + byte;
                }
                return mac;
            }

            // è·å–æœ¬åœ°IPï¼ˆæ¨¡æ‹Ÿï¼‰
            function getLocalIP() {
                // æ¨¡æ‹Ÿå¸¸è§çš„å±€åŸŸç½‘IP
                const ips = ['192.168.1.101', '192.168.0.105', '10.0.0.120', '172.16.0.15'];
                return ips[Math.floor(Math.random() * ips.length)];
            }

            // æ£€æµ‹è®¾å¤‡ç±»å‹
            function detectDeviceType() {
                const ua = navigator.userAgent;
                if (ua.indexOf('Windows') > -1) return 'Windows PC';
                if (ua.indexOf('Mac') > -1) return 'macOS';
                if (ua.indexOf('iPhone') > -1) return 'iPhone';
                if (ua.indexOf('iPad') > -1) return 'iPad';
                if (ua.indexOf('Android') > -1) return 'Android è®¾å¤‡';
                if (ua.indexOf('HarmonyOS') > -1) return 'é¸¿è’™è®¾å¤‡';
                return 'æœªçŸ¥è®¾å¤‡';
            }

            // ç”Ÿæˆè®°å½•å†…å®¹
            function generateRecordContent(phone, name, affiliation, mac, ip, deviceType) {
                const now = new Date();
                const timeStr = now.toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' });
                const dateStr = now.toISOString().split('T')[0];
                
                let content = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
                content += '       èµ¤é€—ç»æµå¼€å‘åŒº å…¥ç½‘å‡­è¯\n';
                content += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
                content += `â±ï¸ å…¥ç½‘æ—¶é—´ï¼š${timeStr}\n`;
                content += `ğŸ“¶ WiFiåç§°ï¼š${WIFI_NAME}\n`;
                content += `ğŸ”‘ WiFiå¯†ç ï¼š${WIFI_PASSWORD}\n`;
                content += `ğŸ“± æ‰‹æœºå·ç ï¼š${phone}\n`;
                content += `ğŸ‘¤ ç”¨æˆ·å§“åï¼š${name}\n`;
                content += `ğŸ¢ æ‰€å±å•ä½ï¼š${affiliation || 'æœªå¡«å†™'}\n`;
                content += `ğŸ–¥ï¸ è®¾å¤‡ç±»å‹ï¼š${deviceType}\n`;
                content += `ğŸŒ IPåœ°å€ï¼š${ip}\n`;
                content += `ğŸ”¢ MACåœ°å€ï¼š${mac}\n\n`;
                content += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
                content += 'æ­¤å‡­è¯ä¸ºå…¥ç½‘ç™»è®°è¯æ˜ï¼Œè¯·å¦¥å–„ä¿ç®¡\n';
                content += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';

                return {
                    content,
                    filename: `å…¥ç½‘å‡­è¯_${phone}_${dateStr}.txt`,
                    date: dateStr,
                    record: {
                        time: timeStr,
                        phone,
                        name,
                        affiliation: affiliation || 'æœªå¡«å†™',
                        wifi: WIFI_NAME,
                        deviceType,
                        ip,
                        mac
                    }
                };
            }

            // ä¸Šä¼ æ•°æ®ï¼ˆæ¨¡æ‹Ÿå†™å…¥æœåŠ¡å™¨ï¼‰
            function uploadToServer(record) {
                // ç”±äºæ˜¯é™æ€é¡µé¢ï¼Œæˆ‘ä»¬ç”¨ localStorage æ¨¡æ‹ŸæœåŠ¡å™¨å­˜å‚¨
                
                // 1. è·å–å½“å‰æœ€å¤§ç¼–å·
                let maxNumber = localStorage.getItem('chidou_max_record_number') || '0';
                maxNumber = parseInt(maxNumber) + 1;
                
                // 2. ä¿å­˜æ¬¡è®°å½•æ–‡ä»¶ (ç®¡ç†å‘˜/è®°å½•/æ¬¡è®°å½•/ç¼–å·.txt)
                const subRecordKey = `chidou_sub_record_${maxNumber}`;
                localStorage.setItem(subRecordKey, JSON.stringify(record));
                
                // 3. ä¿å­˜å…¨éƒ¨è®°å½•æ±‡æ€»
                let allRecords = JSON.parse(localStorage.getItem('chidou_all_records') || '[]');
                allRecords.push({
                    ...record,
                    recordNumber: maxNumber
                });
                localStorage.setItem('chidou_all_records', JSON.stringify(allRecords));
                
                // 4. æ›´æ–°æœ€å¤§ç¼–å·
                localStorage.setItem('chidou_max_record_number', maxNumber.toString());
                
                // 5. æŒ‰æ—¥æœŸä¿å­˜
                const dateStr = record.time.split(' ')[0]; // æå–æ—¥æœŸ
                let dailyRecords = JSON.parse(localStorage.getItem(`chidou_daily_${dateStr}`) || '[]');
                dailyRecords.push({
                    ...record,
                    recordNumber: maxNumber
                });
                localStorage.setItem(`chidou_daily_${dateStr}`, JSON.stringify(dailyRecords));
                
                return maxNumber;
            }

            // ç¬¬ä¸€æ­¥ï¼šå¡«å†™ä¿¡æ¯ â†’ ç¬¬äºŒæ­¥
            toStep2Btn.addEventListener('click', function() {
                const phone = phoneInput.value.trim();
                const name = nameInput.value.trim();
                const affiliation = affInput.value.trim();
                
                if (!phone) {
                    alert('è¯·è¾“å…¥æ‰‹æœºå·ç ');
                    return;
                }
                if (!/^\d{11}$/.test(phone)) {
                    alert('æ‰‹æœºå·å¿…é¡»ä¸º11ä½æ•°å­—');
                    return;
                }
                if (!name) {
                    alert('è¯·è¾“å…¥å§“å');
                    return;
                }
                
                // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
                userPhone = phone;
                userName = name;
                userAffiliation = affiliation;
                
                showStep(2);
            });

            // ç¬¬äºŒæ­¥ï¼šè¿”å›ç¬¬ä¸€æ­¥
            backToStep1Btn.addEventListener('click', function() {
                showStep(1);
            });

            // ç¬¬äºŒæ­¥ â†’ ç¬¬ä¸‰æ­¥
            toStep3Btn.addEventListener('click', function() {
                showStep(3);
            });

            // ç¬¬ä¸‰æ­¥ï¼šè¿”å›ç¬¬äºŒæ­¥
            backToStep2Btn.addEventListener('click', function() {
                showStep(2);
            });

            // ç¬¬ä¸‰æ­¥ï¼šä¸Šä¼ æŒ‰é’®
            uploadBtn.addEventListener('click', function() {
                if (!window.deviceMAC || !window.deviceIP) {
                    uploadStatus.style.display = 'block';
                    uploadStatus.className = 'status-box';
                    uploadStatus.style.borderLeftColor = '#dc3545';
                    uploadStatus.innerHTML = 'âŒ è®¾å¤‡ä¿¡æ¯æœªæ£€æµ‹å®Œæˆï¼Œè¯·ç¨å€™...';
                    return;
                }
                
                // ç”Ÿæˆè®°å½•
                const { content, filename, record } = generateRecordContent(
                    userPhone, 
                    userName, 
                    userAffiliation, 
                    window.deviceMAC, 
                    window.deviceIP,
                    window.deviceType
                );
                
                // ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆæ¨¡æ‹Ÿï¼‰
                const recordNumber = uploadToServer(record);
                
                // ç”Ÿæˆä¸‹è½½æ–‡ä»¶
                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                link.click();
                URL.revokeObjectURL(url);
                
                // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
                uploadStatus.style.display = 'block';
                uploadStatus.className = 'status-box status-success';
                uploadStatus.innerHTML = `
                    âœ… ä¸Šä¼ æˆåŠŸï¼<br>
                    ğŸ“ æ¬¡è®°å½•ç¼–å·ï¼š<strong>${recordNumber}</strong><br>
                    ğŸ“‚ ä¿å­˜ä½ç½®ï¼š<br>
                    &nbsp;&nbsp;â€¢ ç®¡ç†å‘˜/è®°å½•/å…¨éƒ¨è®°å½•.txt<br>
                    &nbsp;&nbsp;â€¢ ç®¡ç†å‘˜/è®°å½•/æ¬¡è®°å½•/${recordNumber}.txt<br>
                    ğŸ’¾ å‡­è¯å·²ä¿å­˜åˆ°æ‚¨çš„ Downloads æ–‡ä»¶å¤¹
                `;
                
                // ç¦ç”¨ä¸Šä¼ æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤æäº¤
                uploadBtn.disabled = true;
                uploadBtn.style.opacity = '0.5';
            });

            // æ‰‹æœºå·è¾“å…¥é™åˆ¶
            phoneInput.addEventListener('input', function() {
                this.value = this.value.replace(/\D/g, '');
            });

            // åˆå§‹åŒ–æ˜¾ç¤ºç¬¬ä¸€æ­¥
            showStep(1);
        })();
    </script>
</body>
</html>