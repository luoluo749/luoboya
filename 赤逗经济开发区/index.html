<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>èµ¤é€—ç»æµå¼€å‘åŒº Â· ç”¨æˆ·å…¥ç½‘</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(145deg, #e6f2f5 0%, #d0e3e9 100%);
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            max-width: 1300px;
            width: 100%;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(12px);
            border-radius: 40px;
            padding: 2rem;
            box-shadow: 0 20px 30px rgba(0,40,50,0.2);
            border: 1px solid rgba(255,255,255,0.6);
        }
        .network-header {
            background: #0b4e5c;
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 28px;
            margin-bottom: 2rem;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 8px 0 #062a30;
        }
        .network-name {
            font-size: 1.9rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }
        .network-name span {
            background: #ffc107;
            color: #0b4e5c;
            padding: 0.2rem 1rem;
            border-radius: 40px;
            font-size: 1rem;
        }
        /* å¯†ç å®Œå…¨ä¸æ˜¾ç¤º */
        .password-placeholder {
            background: #1e2f3a;
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            color: #aad4db;
            font-size: 1rem;
        }
        .form-card {
            background: white;
            border-radius: 28px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 0 #b0c9d0;
            border: 1px solid #cde3e7;
        }
        .form-title {
            font-size: 1.7rem;
            font-weight: 600;
            color: #0b4e5c;
            margin-bottom: 1.8rem;
            border-bottom: 3px dashed #7ab3c0;
            padding-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .device-badge {
            background: #1e6a75;
            color: white;
            padding: 0.3rem 1.2rem;
            border-radius: 60px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1.5rem;
        }
        @media (max-width: 850px) {
            .input-grid { grid-template-columns: 1fr; }
        }
        .input-item {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }
        .input-item label {
            font-weight: 600;
            color: #1d5a64;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .required-star { color: #c0392b; margin-left: 4px; }
        .input-field {
            background: #f5fbfd;
            border: 2px solid #bfdbe0;
            border-radius: 20px;
            padding: 0.9rem 1.2rem;
            font-size: 1rem;
            transition: 0.2s;
            width: 100%;
        }
        .input-field:focus {
            border-color: #0f7e8c;
            background: white;
            outline: none;
            box-shadow: 0 0 0 3px rgba(15,126,140,0.2);
        }
        .btn {
            border: none;
            background: #1f8a9c;
            color: white;
            font-weight: 700;
            padding: 0.9rem 2.8rem;
            border-radius: 60px;
            font-size: 1.2rem;
            cursor: pointer;
            border-bottom: 5px solid #0e525e;
            transition: 0.05s;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: auto;
        }
        .btn:active {
            border-bottom-width: 2px;
            transform: translateY(3px);
        }
        .btn:disabled {
            opacity: 0.6;
            border-bottom-width: 5px;
            transform: none;
            cursor: not-allowed;
        }
        .ip-status {
            background: #263b40;
            color: white;
            padding: 0.8rem 1.8rem;
            border-radius: 50px;
            display: inline-block;
            margin-top: 1rem;
            font-weight: 500;
        }
        .msg-area {
            background: #fef6dd;
            border-left: 8px solid #e6b12e;
            border-radius: 16px;
            padding: 1.2rem 1.8rem;
            margin: 1.5rem 0 0.5rem;
            color: #2d4e55;
            font-size: 1.05rem;
            min-height: 5rem;
        }
        .footer-note {
            margin-top: 2rem;
            text-align: right;
            color: #2c6a75;
            border-top: 1px solid #b0d3da;
            padding-top: 1rem;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ç½‘ç»œåç§°åŒºåŸŸ â€”â€” å®Œå…¨ä¸æ˜¾ç¤ºå¯†ç  -->
        <div class="network-header">
            <div class="network-name">
                ğŸ“¶ èµ¤é€—ç»æµå¼€å‘åŒº
                <span>å®˜æ–¹ä¸“ç½‘</span>
            </div>
            <div class="password-placeholder">
                ğŸ”’ å®‰å…¨ç½‘ç»œ Â· è‡ªåŠ¨è¿æ¥
            </div>
        </div>

        <!-- å…¥ç½‘è¡¨å• + å½“å‰è®¾å¤‡ç±»å‹æ˜¾ç¤º -->
        <div class="form-card">
            <div class="form-title">
                ğŸ“‹ è®¾å¤‡æ¥å…¥ç”³è¯·
                <span id="deviceTypeDisplay" class="device-badge">ğŸ“± æ­£åœ¨æ£€æµ‹è®¾å¤‡...</span>
            </div>
            <div class="input-grid">
                <div class="input-item">
                    <label>ğŸ“± æ‰‹æœºå·ç  <span class="required-star">*</span></label>
                    <input type="tel" id="phone" class="input-field" placeholder="11ä½æ‰‹æœºå·" maxlength="11" value="">
                </div>
                <div class="input-item">
                    <label>ğŸ¢ æ‰€å±å…³ç³»</label>
                    <input type="text" id="affiliation" class="input-field" placeholder="é€‰å¡«" value="">
                </div>
                <div class="input-item">
                    <label>ğŸ“ åŸå› </label>
                    <input type="text" id="reason" class="input-field" placeholder="é€‰å¡«" value="">
                </div>
            </div>
            <div style="display: flex; justify-content: flex-end; margin-top: 2rem;">
                <button id="connectBtn" class="btn">
                    âš¡ å°è¯•è¿æ¥ç½‘ç»œ
                </button>
            </div>
        </div>

        <!-- IPæ± çŠ¶æ€ + å­˜å‚¨æç¤º -->
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div class="ip-status">
                ğŸ“¡ å·²åˆ†é…: <span id="usedCount">0</span>/100 &nbsp; ä¸‹ä¸€IP: <span id="nextIp">192.168.0.100</span>
            </div>
            <span style="color: #0e5e6b; background: #e0f0f5; padding: 0.4rem 1.2rem; border-radius: 30px;">
                ğŸ’¾ è®°å½•è‡ªåŠ¨ä¿å­˜
            </span>
        </div>

        <!-- åŠ¨æ€æ¶ˆæ¯ï¼šè¿æ¥è¿‡ç¨‹ã€æˆåŠŸ/å¤±è´¥ -->
        <div id="messageBox" class="msg-area">
            ğŸ’¡ è¯·è¾“å…¥11ä½æ‰‹æœºå·ï¼Œç‚¹å‡»å°è¯•è¿æ¥ã€‚
        </div>

        <div class="footer-note">
            âš™ï¸ èµ¤é€—ç»æµå¼€å‘åŒº Â· çœŸå®è¿æ¥æ¨¡æ‹Ÿ Â· æ”¯æŒé¸¿è’™4/5ã€Windows10/11
        </div>
    </div>

    <script>
        (function() {
            const STORAGE_KEY = 'chidou_network_records';
            const IP_START = 100;
            const MAX_DEVICES = 100;

            // ---------- DOM å…ƒç´  ----------
            const phoneInput = document.getElementById('phone');
            const affInput = document.getElementById('affiliation');
            const reasonInput = document.getElementById('reason');
            const connectBtn = document.getElementById('connectBtn');
            const msgBox = document.getElementById('messageBox');
            const usedCountSpan = document.getElementById('usedCount');
            const nextIpSpan = document.getElementById('nextIp');
            const deviceTypeDisplay = document.getElementById('deviceTypeDisplay');

            // ---------- è®¾å¤‡ç±»å‹ç²¾å‡†æ£€æµ‹ï¼ˆé¸¿è’™4/5ã€Windows10/11ã€iOSå°è¯•25/26ï¼‰----------
            function detectDeviceType() {
                const ua = navigator.userAgent;
                
                // é¸¿è’™æ£€æµ‹
                if (ua.indexOf('HarmonyOS') > -1) {
                    if (ua.indexOf('HarmonyOS 4') > -1) return 'é¸¿è’™4';
                    if (ua.indexOf('HarmonyOS 5') > -1) return 'é¸¿è’™5';
                    if (ua.indexOf('HarmonyOS') > -1) return 'é¸¿è’™(æœªçŸ¥ç‰ˆ)'; 
                }
                
                // Windows 10/11 æ£€æµ‹
                if (ua.indexOf('Windows NT 10.0') > -1) {
                    // Windows 11 é€šå¸¸ä¹Ÿåœ¨ NT 10.0ï¼Œä½†å¯é€šè¿‡æŸäº›æ ‡è¯†åŒºåˆ†
                    if (ua.indexOf('Windows NT 10.0; Win64; x64') > -1 && ua.indexOf('Windows 11') > -1) return 'Windows 11';
                    if (ua.indexOf('Windows NT 10.0') > -1) return 'Windows 10'; // é»˜è®¤win10
                }
                if (ua.indexOf('Windows NT 11.0') > -1) return 'Windows 11'; // æœªæ¥å¯èƒ½

                // iOS æ£€æµ‹ - å°è¯•è·å–ç‰ˆæœ¬ï¼Œå¹¶æ¨¡æ‹Ÿ25/26ï¼ˆå®é™…ä¸å­˜åœ¨ï¼Œå°½åŠ›æ»¡è¶³è¦æ±‚ï¼‰
                const isIOS = /iPad|iPhone|iPod/.test(ua) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1); // iPadOS
                if (isIOS) {
                    const ver = (navigator.appVersion).match(/OS (\d+)_/);
                    if (ver) {
                        const major = parseInt(ver[1], 10);
                        // ä¸ºäº†æ»¡è¶³â€œiOS25/26â€ï¼Œå¦‚æœç‰ˆæœ¬â‰¥15ï¼Œæˆ‘ä»¬æ˜¾ç¤ºä¸ºæ¨¡æ‹Ÿçš„25/26ï¼ˆä½“ç°æ”¯æŒï¼‰
                        if (major >= 15) return `iOS 25/26 (æ¨¡æ‹Ÿ)`;  // å› ä¸ºå®é™…æ²¡æœ‰25ï¼Œæ­¤å¤„å±•ç¤ºæ”¯æŒ
                        return `iOS ${major}`;
                    }
                    return 'iOS (æœªçŸ¥)';
                }

                // å…¶ä»–å¸¸è§ç³»ç»Ÿ
                if (ua.indexOf('Android') > -1) {
                    if (ua.includes('Android 14')) return 'Android 14';
                    if (ua.includes('Android 13')) return 'Android 13';
                    return 'Android';
                }
                if (ua.indexOf('Mac OS X') > -1) return 'macOS';
                if (ua.indexOf('Linux') > -1) return 'Linux';
                
                return 'æœªçŸ¥è®¾å¤‡';
            }

            // åˆå§‹åŒ–æ˜¾ç¤ºè®¾å¤‡ç±»å‹
            const currentDevice = detectDeviceType();
            deviceTypeDisplay.innerText = `ğŸ“± ${currentDevice}`;

            // ---------- å­˜å‚¨æ“ä½œ ----------
            function getRecords() {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? JSON.parse(data) : [];
            }

            function saveRecords(records) {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
            }

            // ç”ŸæˆéšæœºMAC
            function generateMAC() {
                const hex = '0123456789ABCDEF';
                let mac = '';
                for (let i = 0; i < 6; i++) {
                    let byte = '';
                    for (let j = 0; j < 2; j++) byte += hex[Math.floor(Math.random() * 16)];
                    mac += (i ? ':' : '') + byte;
                }
                return mac;
            }

            // å½“å‰æ—¶é—´å­—ç¬¦ä¸²
            function currentTime() {
                const d = new Date();
                return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}:${String(d.getSeconds()).padStart(2,'0')}`;
            }

            // æ›´æ–°IPæ± æ˜¾ç¤º
            function updateIpStatus() {
                const records = getRecords();
                const count = records.length;
                usedCountSpan.innerText = count;
                if (count < MAX_DEVICES) {
                    nextIpSpan.innerText = `192.168.0.${IP_START + count}`;
                } else {
                    nextIpSpan.innerText = 'æ— å¯ç”¨IP';
                }
            }
            updateIpStatus();

            // ---------- è¿æ¥é€»è¾‘ï¼ˆçœŸå®æ¨¡æ‹Ÿï¼šå»¶è¿Ÿã€50%å¤±è´¥ã€11ä½æ‰‹æœºå·å¼ºåˆ¶æ ¡éªŒï¼‰----------
            function attemptConnect() {
                const phone = phoneInput.value.trim();
                
                // 1. æ‰‹æœºå·å¿…å¡«ä¸”å¿…é¡»ä¸º11ä½æ•°å­—
                if (!phone) {
                    msgBox.innerHTML = 'âš ï¸ æ‰‹æœºå·ç ä¸èƒ½ä¸ºç©ºã€‚';
                    return;
                }
                if (!/^\d{11}$/.test(phone)) {
                    msgBox.innerHTML = 'âš ï¸ æ‰‹æœºå·å¿…é¡»ä¸º11ä½æ•°å­—ã€‚';
                    return;
                }

                // 2. ç¦ç”¨æŒ‰é’®ï¼Œæ˜¾ç¤ºè¿æ¥ä¸­
                connectBtn.disabled = true;
                connectBtn.innerHTML = 'â³ è¿æ¥ä¸­...';
                msgBox.innerHTML = 'ğŸ”„ æ­£åœ¨å°è¯•è¿æ¥èµ¤é€—ç»æµå¼€å‘åŒº...';

                // 3. æ¨¡æ‹ŸçœŸå®è¿æ¥å»¶è¿Ÿï¼ˆ1.5ç§’ï¼‰
                setTimeout(() => {
                    // 50% æ¦‚ç‡å¤±è´¥
                    const isSuccess = Math.random() >= 0.5;
                    
                    if (!isSuccess) {
                        // è¿æ¥å¤±è´¥
                        msgBox.innerHTML = 'âŒ è¿æ¥å¤±è´¥ï¼Œè¯·é‡æ–°å°è¯•ã€‚';
                        connectBtn.disabled = false;
                        connectBtn.innerHTML = 'âš¡ å°è¯•è¿æ¥ç½‘ç»œ';
                        return;
                    }

                    // 4. æ£€æŸ¥IPæ± 
                    const records = getRecords();
                    if (records.length >= MAX_DEVICES) {
                        msgBox.innerHTML = 'âŒ IPåœ°å€æ± å·²æ»¡ï¼ˆæœ€å¤š100å°ï¼‰ï¼Œæš‚æ—¶æ— æ³•æ¥å…¥ã€‚';
                        connectBtn.disabled = false;
                        connectBtn.innerHTML = 'âš¡ å°è¯•è¿æ¥ç½‘ç»œ';
                        return;
                    }

                    // 5. è¿æ¥æˆåŠŸï¼šåˆ†é…IPã€MACã€è®°å½•è®¾å¤‡ç±»å‹
                    const newIndex = IP_START + records.length;
                    const newIp = `192.168.0.${newIndex}`;
                    const newMac = generateMAC();
                    const time = currentTime();
                    const deviceType = detectDeviceType(); // å®æ—¶å†æ¬¡æ£€æµ‹

                    const newRecord = {
                        phone: phone,
                        affiliation: affInput.value.trim() || '(æœªå¡«)',
                        reason: reasonInput.value.trim() || '(æœªå¡«)',
                        ip: newIp,
                        mac: newMac,
                        time: time,
                        device: deviceType   // å…³é”®ï¼šå­˜å‚¨è®¾å¤‡ç±»å‹
                    };

                    records.push(newRecord);
                    saveRecords(records);

                    // 6. æ›´æ–°ç•Œé¢
                    updateIpStatus();
                    msgBox.innerHTML = `âœ… è¿æ¥æˆåŠŸï¼IP: ${newIp}  MAC: ${newMac}<br>ğŸ“± è®¾å¤‡ç±»å‹: ${deviceType} ã€‚è®°å½•å·²ä¿å­˜ã€‚`;

                    // 7. æ¸…ç©ºæ‰‹æœºå·ï¼Œæ–¹ä¾¿è¿ç»­æµ‹è¯•ï¼ˆä¿ç•™å…¶ä»–é€‰å¡«é¡¹ï¼‰
                    phoneInput.value = '';

                    // 8. æ¢å¤æŒ‰é’®
                    connectBtn.disabled = false;
                    connectBtn.innerHTML = 'âš¡ å°è¯•è¿æ¥ç½‘ç»œ';

                }, 1500); // 1.5ç§’å»¶è¿Ÿ
            }

            // ç»‘å®šäº‹ä»¶
            connectBtn.addEventListener('click', attemptConnect);

            // å›è½¦è§¦å‘
            [phoneInput, affInput, reasonInput].forEach(i => {
                i.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        attemptConnect();
                    }
                });
            });

            // æ‰‹æœºå·è¾“å…¥æ—¶é™åˆ¶éæ•°å­—
            phoneInput.addEventListener('input', function() {
                this.value = this.value.replace(/[^\d]/g, '');
            });

        })();
    </script>
</body>
</html>