<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>èµ¤é€—ç»æµå¼€å‘åŒº Â· å®˜æ–¹å…¥ç½‘</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(145deg, #1a4b58 0%, #0d3b45 100%);
            font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
        }

        .container {
            max-width: 900px;
            width: 100%;
        }

        .main-card {
            background: white;
            border-radius: 48px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }

        /* æ­¥éª¤æŒ‡ç¤ºå™¨ */
        .steps-header {
            display: flex;
            background: #f8fbfc;
            padding: 1.5rem 2rem;
            border-bottom: 3px solid #ffc107;
        }
        .step {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0edf2;
            color: #1d5a64;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }
        .step.active .step-number {
            background: #ffc107;
            color: #0b3b44;
            box-shadow: 0 4px 0 #b8820b;
        }
        .step-title {
            font-weight: 600;
            color: #1d5a64;
        }
        .step.active .step-title {
            color: #0b3b44;
            font-weight: 700;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content-area {
            padding: 2.5rem;
        }

        .step-one, .step-two, .step-three {
            display: none;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #0b4e5c;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .section-title span {
            background: #ffc107;
            color: #0b4e5c;
            padding: 0.2rem 1rem;
            border-radius: 40px;
            font-size: 0.9rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .input-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .input-item label {
            font-weight: 600;
            color: #1d5a64;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }
        .required-star {
            color: #c0392b;
            margin-left: 4px;
        }
        .optional-tag {
            color: #6c757d;
            font-size: 0.8rem;
            font-weight: normal;
            margin-left: 0.5rem;
        }
        .input-field {
            background: #f5fbfd;
            border: 2px solid #bfdbe0;
            border-radius: 30px;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            transition: 0.2s;
            width: 100%;
        }
        .input-field:focus {
            border-color: #0f7e8c;
            background: white;
            outline: none;
            box-shadow: 0 0 0 4px rgba(15,126,140,0.15);
        }
        .input-field:disabled {
            background: #e9ecef;
            color: #6c757d;
        }

        .btn {
            border: none;
            font-weight: 700;
            padding: 1rem 2.5rem;
            border-radius: 60px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.05s linear;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
        }
        .btn-primary {
            background: #1f8a9c;
            color: white;
            border-bottom: 6px solid #0e525e;
        }
        .btn-primary:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }
        .btn-warning {
            background: #ffc107;
            color: #0b3b44;
            border-bottom: 6px solid #b8820b;
        }
        .btn-warning:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }
        .btn-success {
            background: #28a745;
            color: white;
            border-bottom: 6px solid #1e7e34;
        }
        .btn-success:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        .wifi-info-card {
            background: linear-gradient(135deg, #0f5a66 0%, #0b4752 100%);
            border-radius: 32px;
            padding: 2rem;
            color: white;
            margin: 2rem 0;
            box-shadow: 0 10px 0 #06333b;
        }
        .wifi-name {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .wifi-password-box {
            background: rgba(0,0,0,0.3);
            border-radius: 24px;
            padding: 1.5rem;
            text-align: center;
            margin: 1.5rem 0;
        }
        .wifi-password {
            font-size: 3rem;
            font-weight: 800;
            font-family: monospace;
            letter-spacing: 8px;
            background: #1e3a42;
            padding: 0.5rem 2rem;
            border-radius: 60px;
            border: 2px dashed #ffc107;
            color: #ffe484;
            word-break: break-word;
        }
        .copy-btn {
            background: #ffc107;
            border: none;
            color: #0b3b44;
            font-weight: 700;
            padding: 0.8rem 2rem;
            border-radius: 50px;
            margin-top: 1rem;
            cursor: pointer;
            border-bottom: 4px solid #b8820b;
        }

        .status-box {
            background: #f8f9fa;
            border-left: 10px solid #6c757d;
            border-radius: 20px;
            padding: 1.5rem;
            margin: 2rem 0;
            font-size: 1.1rem;
        }
        .status-success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .status-error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .status-info {
            border-left-color: #17a2b8;
            background: #d1ecf1;
        }
        .reminder-box {
            background: #fff3cd;
            border-left: 10px solid #ffc107;
            border-radius: 20px;
            padding: 1.2rem;
            margin: 1.5rem 0;
        }
        .button-group {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            flex-wrap: wrap;
        }
        .info-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 1rem;
            align-items: center;
        }
        .info-label {
            font-weight: 600;
            color: #1d5a64;
        }
        .info-value {
            font-family: monospace;
            background: #e9ecef;
            padding: 0.3rem 1rem;
            border-radius: 30px;
        }
        .mac-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        .detect-mac-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 30px;
            cursor: pointer;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-card">
            <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
            <div class="steps-header">
                <div class="step active" id="step1Indicator">
                    <div class="step-number">1</div>
                    <div class="step-title">å¡«å†™ä¿¡æ¯</div>
                </div>
                <div class="step" id="step2Indicator">
                    <div class="step-number">2</div>
                    <div class="step-title">è¿æ¥WiFi</div>
                </div>
                <div class="step" id="step3Indicator">
                    <div class="step-number">3</div>
                    <div class="step-title">ä¸Šä¼ å‡­è¯</div>
                </div>
            </div>

            <!-- å†…å®¹åŒºåŸŸ -->
            <div class="content-area">
                <!-- ç¬¬ä¸€æ­¥ï¼šå¡«å†™ä¿¡æ¯ -->
                <div id="stepOne" class="step-one">
                    <div class="section-title">
                        ğŸ“‹ å¡«å†™å…¥ç½‘ä¿¡æ¯
                        <span>å¿…å¡«</span>
                    </div>
                    
                    <div class="form-grid">
                        <div class="input-item">
                            <label>ğŸ“± æ‰‹æœºå·ç  <span class="required-star">*</span></label>
                            <input type="tel" id="phone" class="input-field" placeholder="11ä½æ‰‹æœºå·" maxlength="11">
                        </div>
                        <div class="input-item">
                            <label>ğŸ‘¤ å§“å <span class="required-star">*</span></label>
                            <input type="text" id="name" class="input-field" placeholder="çœŸå®å§“å">
                        </div>
                        <div class="input-item">
                            <label>ğŸ¢ æ‰€å±å•ä½</label>
                            <input type="text" id="affiliation" class="input-field" placeholder="é€‰å¡«">
                        </div>
                        <div class="input-item">
                            <label>ğŸ”¢ MACåœ°å€ <span class="optional-tag">é€‰å¡«</span></label>
                            <div class="mac-input-group">
                                <input type="text" id="mac" class="input-field" placeholder="å¦‚: 00:1A:2B:3C:4D:5E" 
                                       pattern="^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$" 
                                       title="è¯·è¾“å…¥æ­£ç¡®çš„MACåœ°å€æ ¼å¼ (å¦‚: 00:1A:2B:3C:4D:5E)">
                                <button id="generateMacBtn" class="detect-mac-btn" type="button">ğŸ² éšæœºç”Ÿæˆ</button>
                            </div>
                            <small style="color:#6c757d; margin-top:0.3rem;">MACåœ°å€å¯é€‰å¡«ï¼Œç”¨äºè®¾å¤‡è¯†åˆ«</small>
                        </div>
                    </div>

                    <div class="reminder-box">
                        <strong>ğŸ“Œ å¡«å†™å®Œæˆåï¼š</strong> ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–WiFiä¿¡æ¯ï¼Œç„¶åæ‰‹åŠ¨è¿æ¥ç½‘ç»œ
                    </div>

                    <div class="button-group">
                        <button id="toStep2Btn" class="btn btn-primary">ä¸‹ä¸€æ­¥ï¼šè·å–WiFiä¿¡æ¯ â†’</button>
                    </div>
                </div>

                <!-- ç¬¬äºŒæ­¥ï¼šæ˜¾ç¤ºWiFiä¿¡æ¯ -->
                <div id="stepTwo" class="step-two">
                    <div class="section-title">
                        ğŸ“¶ è¿æ¥WiFiç½‘ç»œ
                    </div>

                    <div class="wifi-info-card">
                        <div class="wifi-name">
                            ğŸ“¡ èµ¤é€—ç»æµå¼€å‘åŒº
                            <span style="background:#ffc107; color:#0b3b44; padding:0.2rem 1rem; border-radius:40px; font-size:0.9rem;">å®˜æ–¹ä¸“ç½‘</span>
                        </div>
                        
                        <div class="wifi-password-box">
                            <div style="margin-bottom:1rem; opacity:0.9;">WiFi å¯†ç </div>
                            <div class="wifi-password" id="wifiPassword">20268888</div>
                            <button class="copy-btn" id="copyBtn">ğŸ“‹ å¤åˆ¶å¯†ç </button>
                        </div>

                        <div style="background:white; color:#0b4e5c; border-radius:20px; padding:1.5rem;">
                            <strong>ğŸ“± è¿æ¥æ­¥éª¤ï¼š</strong>
                            <ol style="margin-top:0.8rem; margin-left:1.5rem;">
                                <li>æ‰“å¼€æ‰‹æœºã€Œè®¾ç½®ã€>ã€ŒWLAN/WiFiã€</li>
                                <li>æ‰¾åˆ°ç½‘ç»œ <strong>â€œèµ¤é€—ç»æµå¼€å‘åŒºâ€</strong></li>
                                <li>è¾“å…¥å¯†ç  <strong>20268888</strong></li>
                                <li>ç‚¹å‡»ã€Œè¿æ¥ã€</li>
                            </ol>
                        </div>
                    </div>

                    <div class="reminder-box">
                        <strong>âš ï¸ é‡è¦æé†’ï¼š</strong> è¿æ¥WiFiæˆåŠŸåï¼Œè¯·åŠ¡å¿…è¿”å›æœ¬é¡µï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å®Œæˆæœ€åä¸€æ­¥ï¼
                    </div>

                    <div class="button-group">
                        <button id="backToStep1Btn" class="btn" style="background:#e0edf2; color:#1d5a64;">â† ä¸Šä¸€æ­¥</button>
                        <button id="toStep3Btn" class="btn btn-warning">âœ… æˆ‘å·²è¿æ¥æˆåŠŸï¼Œä¸‹ä¸€æ­¥</button>
                    </div>
                </div>

                <!-- ç¬¬ä¸‰æ­¥ï¼šä¸Šä¼ å‡­è¯ -->
                <div id="stepThree" class="step-three">
                    <div class="section-title">
                        ğŸ”„ è‡ªåŠ¨ä¸Šä¼ å‡­è¯
                    </div>

                    <div id="deviceInfo" class="status-box status-info">
                        <div style="display:flex; align-items:center; gap:1rem;">
                            <span>ğŸ” æ­£åœ¨è·å–æ‚¨çš„çœŸå®IPåœ°å€...</span>
                            <div class="spinner" style="width:20px; height:20px; border:3px solid #17a2b8; border-top-color:transparent; border-radius:50%; animation:spin 1s linear infinite;"></div>
                        </div>
                    </div>

                    <style>
                        @keyframes spin { to { transform: rotate(360deg); } }
                    </style>

                    <div id="uploadStatus" class="status-box" style="display: none;">
                        <!-- åŠ¨æ€æ˜¾ç¤ºä¸Šä¼ çŠ¶æ€ -->
                    </div>

                    <div class="button-group">
                        <button id="backToStep2Btn" class="btn" style="background:#e0edf2; color:#1d5a64;">â† è¿”å›</button>
                        <button id="uploadBtn" class="btn btn-success" disabled>ğŸ“¤ æ­£åœ¨è·å–IPï¼Œè¯·ç¨å€™...</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // WiFiä¿¡æ¯
            const WIFI_NAME = 'èµ¤é€—ç»æµå¼€å‘åŒº';
            const WIFI_PASSWORD = '20268888';
            
            // å­˜å‚¨ç”¨æˆ·å¡«å†™çš„ä¿¡æ¯
            let userPhone = '';
            let userName = '';
            let userAffiliation = '';
            let userMac = '';

            // DOM å…ƒç´ 
            const step1Indicator = document.getElementById('step1Indicator');
            const step2Indicator = document.getElementById('step2Indicator');
            const step3Indicator = document.getElementById('step3Indicator');
            
            const stepOne = document.getElementById('stepOne');
            const stepTwo = document.getElementById('stepTwo');
            const stepThree = document.getElementById('stepThree');
            
            const phoneInput = document.getElementById('phone');
            const nameInput = document.getElementById('name');
            const affInput = document.getElementById('affiliation');
            const macInput = document.getElementById('mac');
            const generateMacBtn = document.getElementById('generateMacBtn');
            
            const toStep2Btn = document.getElementById('toStep2Btn');
            const backToStep1Btn = document.getElementById('backToStep1Btn');
            const toStep3Btn = document.getElementById('toStep3Btn');
            const backToStep2Btn = document.getElementById('backToStep2Btn');
            const uploadBtn = document.getElementById('uploadBtn');
            const copyBtn = document.getElementById('copyBtn');
            
            const deviceInfo = document.getElementById('deviceInfo');
            const uploadStatus = document.getElementById('uploadStatus');

            // çœŸå®IPåœ°å€å­˜å‚¨
            let realIP = 'æ­£åœ¨è·å–...';

            // æ­¥éª¤åˆ‡æ¢å‡½æ•°
            function showStep(step) {
                stepOne.style.display = 'none';
                stepTwo.style.display = 'none';
                stepThree.style.display = 'none';
                
                step1Indicator.classList.remove('active');
                step2Indicator.classList.remove('active');
                step3Indicator.classList.remove('active');
                
                if (step === 1) {
                    stepOne.style.display = 'block';
                    step1Indicator.classList.add('active');
                } else if (step === 2) {
                    stepTwo.style.display = 'block';
                    step2Indicator.classList.add('active');
                } else if (step === 3) {
                    stepThree.style.display = 'block';
                    step3Indicator.classList.add('active');
                    // è¿›å…¥ç¬¬ä¸‰æ­¥æ—¶è·å–çœŸå®IP
                    getRealIP();
                }
            }

            // è·å–çœŸå®IPï¼ˆä½¿ç”¨WebRTCï¼‰
            function getRealIP() {
                deviceInfo.innerHTML = '<div style="display:flex; align-items:center; gap:1rem;"><span>ğŸ” æ­£åœ¨é€šè¿‡WebRTCè·å–æ‚¨çš„çœŸå®IPåœ°å€...</span><div class="spinner" style="width:20px; height:20px; border:3px solid #17a2b8; border-top-color:transparent; border-radius:50%; animation:spin 1s linear infinite;"></div></div>';
                uploadBtn.disabled = true;
                uploadBtn.innerHTML = 'ğŸ“¤ æ­£åœ¨è·å–IPï¼Œè¯·ç¨å€™...';

                // ä½¿ç”¨RTCPeerConnectionè·å–å†…ç½‘IP
                const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                const pc = new RTCPeerConnection({ iceServers: [] });
                
                // åˆ›å»ºæ•°æ®é€šé“è§¦å‘ICEå€™é€‰
                pc.createDataChannel('');
                
                pc.createOffer().then(offer => pc.setLocalDescription(offer)).catch(e => {
                    console.error('Offeråˆ›å»ºå¤±è´¥', e);
                });

                let timeout = setTimeout(() => {
                    if (realIP === 'æ­£åœ¨è·å–...') {
                        realIP = 'è·å–è¶…æ—¶ï¼Œè¯·é‡è¯•';
                        updateDeviceInfo(realIP);
                    }
                }, 5000);

                pc.onicecandidate = (ice) => {
                    if (ice.candidate) {
                        const ipMatch = ipRegex.exec(ice.candidate.candidate);
                        if (ipMatch && ipMatch[1] && !ipMatch[1].startsWith('127.')) {
                            realIP = ipMatch[1];
                            clearTimeout(timeout);
                            updateDeviceInfo(realIP);
                            pc.close();
                        }
                    }
                };

                // é™çº§æ–¹æ¡ˆï¼šå¦‚æœWebRTCå¤±è´¥ï¼Œå°è¯•è·å–å…¬ç½‘IPï¼ˆé€šè¿‡ç¬¬ä¸‰æ–¹APIï¼‰
                setTimeout(() => {
                    if (realIP === 'æ­£åœ¨è·å–...') {
                        fetch('https://api.ipify.org?format=json')
                            .then(response => response.json())
                            .then(data => {
                                realIP = data.ip + ' (å…¬ç½‘IP)';
                                updateDeviceInfo(realIP);
                            })
                            .catch(() => {
                                realIP = 'æ— æ³•è·å–IPï¼Œè¯·æ‰‹åŠ¨å¡«å†™';
                                updateDeviceInfo(realIP);
                            });
                    }
                }, 3000);
            }

            function updateDeviceInfo(ip) {
                const mac = macInput.value.trim() || 'æœªå¡«å†™';
                
                deviceInfo.innerHTML = `
                    <div class="info-grid">
                        <div class="info-label">ğŸŒ æ‚¨çš„IPåœ°å€ï¼š</div>
                        <div><code class="info-value">${ip}</code></div>
                        <div class="info-label">ğŸ”¢ MACåœ°å€ï¼š</div>
                        <div><code class="info-value">${mac || 'æœªå¡«å†™'}</code></div>
                        <div class="info-label">ğŸ“± æ‰‹æœºå·ç ï¼š</div>
                        <div>${userPhone}</div>
                        <div class="info-label">ğŸ‘¤ å§“åï¼š</div>
                        <div>${userName}</div>
                        <div class="info-label">ğŸ“¶ è¿æ¥ç½‘ç»œï¼š</div>
                        <div>${WIFI_NAME}</div>
                    </div>
                `;
                
                // å¯ç”¨ä¸Šä¼ æŒ‰é’®
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = 'ğŸ“¤ ä¸Šä¼ å‡­è¯å¹¶ä¸‹è½½æ–‡ä»¶';
            }

            // ç”ŸæˆéšæœºMACåœ°å€ï¼ˆç”¨äºé€‰å¡«ï¼‰
            function generateRandomMAC() {
                const hex = '0123456789ABCDEF';
                let mac = '';
                for (let i = 0; i < 6; i++) {
                    let byte = '';
                    for (let j = 0; j < 2; j++) byte += hex[Math.floor(Math.random() * 16)];
                    mac += (i ? ':' : '') + byte;
                }
                return mac;
            }

            // å¤åˆ¶å¯†ç 
            copyBtn.addEventListener('click', function() {
                navigator.clipboard.writeText(WIFI_PASSWORD).then(() => {
                    const original = copyBtn.innerText;
                    copyBtn.innerText = 'âœ… å·²å¤åˆ¶ï¼';
                    copyBtn.style.background = '#28a745';
                    copyBtn.style.color = 'white';
                    setTimeout(() => {
                        copyBtn.innerText = original;
                        copyBtn.style.background = '#ffc107';
                        copyBtn.style.color = '#0b3b44';
                    }, 1500);
                });
            });

            // ç”ŸæˆéšæœºMAC
            generateMacBtn.addEventListener('click', function() {
                macInput.value = generateRandomMAC();
            });

            // ç¬¬ä¸€æ­¥ï¼šå¡«å†™ä¿¡æ¯ â†’ ç¬¬äºŒæ­¥
            toStep2Btn.addEventListener('click', function() {
                const phone = phoneInput.value.trim();
                const name = nameInput.value.trim();
                
                if (!phone) {
                    alert('è¯·è¾“å…¥æ‰‹æœºå·ç ');
                    return;
                }
                if (!/^\d{11}$/.test(phone)) {
                    alert('æ‰‹æœºå·å¿…é¡»ä¸º11ä½æ•°å­—');
                    return;
                }
                if (!name) {
                    alert('è¯·è¾“å…¥å§“å');
                    return;
                }
                
                // ä¿å­˜ç”¨æˆ·ä¿¡æ¯
                userPhone = phone;
                userName = name;
                userAffiliation = affInput.value.trim();
                userMac = macInput.value.trim();
                
                showStep(2);
            });

            // ç¬¬äºŒæ­¥ï¼šè¿”å›ç¬¬ä¸€æ­¥
            backToStep1Btn.addEventListener('click', function() {
                showStep(1);
            });

            // ç¬¬äºŒæ­¥ â†’ ç¬¬ä¸‰æ­¥
            toStep3Btn.addEventListener('click', function() {
                showStep(3);
            });

            // ç¬¬ä¸‰æ­¥ï¼šè¿”å›ç¬¬äºŒæ­¥
            backToStep2Btn.addEventListener('click', function() {
                showStep(2);
            });

            // ç¬¬ä¸‰æ­¥ï¼šä¸Šä¼ æŒ‰é’®
            uploadBtn.addEventListener('click', function() {
                // ç”Ÿæˆè®°å½•å†…å®¹
                const now = new Date();
                const timeStr = now.toLocaleString('zh-CN', { timeZone: 'Asia/Shanghai' });
                const dateStr = now.toISOString().split('T')[0];
                
                const record = {
                    time: timeStr,
                    phone: userPhone,
                    name: userName,
                    affiliation: userAffiliation || 'æœªå¡«å†™',
                    wifi: WIFI_NAME,
                    ip: realIP,
                    mac: userMac || 'æœªå¡«å†™'
                };

                // ä¿å­˜åˆ°localStorageï¼ˆæ¨¡æ‹ŸæœåŠ¡å™¨ï¼‰
                let allRecords = JSON.parse(localStorage.getItem('chidou_all_records') || '[]');
                const recordNumber = allRecords.length + 1;
                
                // ä¿å­˜æ¬¡è®°å½•
                localStorage.setItem(`chidou_sub_record_${recordNumber}`, JSON.stringify(record));
                
                // ä¿å­˜åˆ°å…¨éƒ¨è®°å½•
                allRecords.push({...record, recordNumber});
                localStorage.setItem('chidou_all_records', JSON.stringify(allRecords));
                
                // ç”Ÿæˆä¸‹è½½æ–‡ä»¶
                let content = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
                content += '       èµ¤é€—ç»æµå¼€å‘åŒº å…¥ç½‘å‡­è¯\n';
                content += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
                content += `â±ï¸ å…¥ç½‘æ—¶é—´ï¼š${timeStr}\n`;
                content += `ğŸ“¶ WiFiåç§°ï¼š${WIFI_NAME}\n`;
                content += `ğŸ”‘ WiFiå¯†ç ï¼š${WIFI_PASSWORD}\n`;
                content += `ğŸ“± æ‰‹æœºå·ç ï¼š${userPhone}\n`;
                content += `ğŸ‘¤ ç”¨æˆ·å§“åï¼š${userName}\n`;
                content += `ğŸ¢ æ‰€å±å•ä½ï¼š${userAffiliation || 'æœªå¡«å†™'}\n`;
                content += `ğŸŒ IPåœ°å€ï¼š${realIP}\n`;
                content += `ğŸ”¢ MACåœ°å€ï¼š${userMac || 'æœªå¡«å†™'}\n\n`;
                content += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
                content += 'æ­¤å‡­è¯ä¸ºå…¥ç½‘ç™»è®°è¯æ˜ï¼Œè¯·å¦¥å–„ä¿ç®¡\n';
                content += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';

                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `å…¥ç½‘å‡­è¯_${userPhone}_${dateStr}.txt`;
                link.click();
                URL.revokeObjectURL(url);
                
                // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
                uploadStatus.style.display = 'block';
                uploadStatus.className = 'status-box status-success';
                uploadStatus.innerHTML = `
                    âœ… ä¸Šä¼ æˆåŠŸï¼<br>
                    ğŸ“ æ¬¡è®°å½•ç¼–å·ï¼š<strong>${recordNumber}</strong><br>
                    ğŸ“‚ æœåŠ¡å™¨è·¯å¾„ï¼š<br>
                    &nbsp;&nbsp;â€¢ ç®¡ç†å‘˜/è®°å½•/å…¨éƒ¨è®°å½•.txt<br>
                    &nbsp;&nbsp;â€¢ ç®¡ç†å‘˜/è®°å½•/æ¬¡è®°å½•/${recordNumber}.txt<br>
                    ğŸ’¾ å‡­è¯å·²ä¿å­˜åˆ°æ‚¨çš„ Downloads æ–‡ä»¶å¤¹
                `;
                
                // ç¦ç”¨ä¸Šä¼ æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤æäº¤
                uploadBtn.disabled = true;
                uploadBtn.style.opacity = '0.5';
            });

            // æ‰‹æœºå·è¾“å…¥é™åˆ¶
            phoneInput.addEventListener('input', function() {
                this.value = this.value.replace(/\D/g, '');
            });

            // MACåœ°å€æ ¼å¼åŒ–ï¼ˆè‡ªåŠ¨æ·»åŠ å†’å·ï¼‰
            macInput.addEventListener('input', function() {
                let value = this.value.replace(/[^0-9A-Fa-f]/g, '').toUpperCase();
                if (value.length > 12) value = value.slice(0, 12);
                
                let formatted = '';
                for (let i = 0; i < value.length; i++) {
                    if (i > 0 && i % 2 === 0) formatted += ':';
                    formatted += value[i];
                }
                this.value = formatted;
            });

            // åˆå§‹åŒ–æ˜¾ç¤ºç¬¬ä¸€æ­¥
            showStep(1);
        })();
    </script>
</body>
</html>